# Configuracion basica de la aplicacion
spring.application.name=CitaSaludApplication
server.port=${PORT:8080}
# Bind address (ensure Fly's proxy can reach the app)
server.address=${BIND_ADDRESS:0.0.0.0}

# Configuracion de conexion a la base de datos PostgreSQL
# Use environment variables in production to avoid committing secrets.
# Example values are provided in application.properties.example and README-deploy.md
spring.datasource.url=${SPRING_DATASOURCE_URL:jdbc:postgresql://localhost:5432/postgres}
spring.datasource.username=${SPRING_DATASOURCE_USERNAME:postgres}
spring.datasource.password=${SPRING_DATASOURCE_PASSWORD:password}
spring.datasource.driver-class-name=org.postgresql.Driver

# JPA / Hibernate
spring.jpa.database-platform=org.hibernate.dialect.PostgreSQLDialect
## Hibernate DDL auto
# In production we disable automatic schema updates to avoid extra
# connections and potential DDL operations at startup. Use an
# environment-specific profile if you need `update` during local/dev.
spring.jpa.hibernate.ddl-auto=none
spring.jpa.show-sql=true
spring.jpa.properties.hibernate.format_sql=true

# HikariCP tuning: limit pool size so we don't exhaust DB connections
# on small hosted DB plans (adjust via env or profile as needed)
spring.datasource.hikari.maximum-pool-size=1
# Allow zero minimum idle so the pool does not hold idle connections when unused
spring.datasource.hikari.minimum-idle=0
spring.datasource.hikari.connection-timeout=30000

# Avoid Hibernate querying JDBC metadata during startup which can open extra
# connections to the database on some drivers/hosts. This reduces metadata
# calls that caused "Max client connections reached" on small DB plans.
spring.jpa.open-in-view=false
spring.jpa.properties.hibernate.temp.use_jdbc_metadata_defaults=false

# Prevent any automatic SQL schema initialization at startup
spring.jpa.generate-ddl=false
spring.sql.init.mode=never
spring.jpa.defer-datasource-initialization=true

# Niveles de logging
logging.level.org.springframework=INFO
logging.level.org.hibernate.SQL=DEBUG
logging.level.org.hibernate.type.descriptor.sql.BasicBinder=TRACE

# Transacciones
spring.transaction.default-timeout=30
spring.transaction.rollback-on-commit-failure=true

# Reduce startup JDBC pressure by lazily initializing beans (delay JPA until first use)
spring.main.lazy-initialization=true

# Limit embedded Tomcat worker threads to reduce concurrent DB demands
server.tomcat.max-threads=1
server.tomcat.min-spare-threads=1

# Prefer the newer property name to avoid JDBC metadata access which can open
# additional connections on some DB hosts during startup.
spring.jpa.properties.hibernate.boot.allow_jdbc_metadata_access=false

# Configuracion de negociacion de contenido
spring.mvc.contentnegotiation.favor-path-extension=false
spring.mvc.contentnegotiation.favor-parameter=false
spring.mvc.contentnegotiation.media-types.json=application/json

# JWT: secreto y tiempo de expiracion (milisegundos)
# Provide JWT secret via environment variable in production
app.jwtSecret=${APP_JWTSECRET:default_dev_jwt_secret}
app.jwtExpirationInMs=${APP_JWT_EXPIRATION_MS:1800000}

spring.graphql.graphiql.enabled=true

